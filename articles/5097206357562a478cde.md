---
title: "POSTとPUTとPATCHの使い分け"
emoji: "🍣"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['HTTP']
published: true
---

こんにちは、toppoです。

最近業務でWeb APIをRESTで作成する際、HTTPメソッドは基本的にPOST or GETで作成していました。

ふと「あれ、PUTとPATCH使わなくても一応API作れるな。。？」と思ったので、改めてそれぞれの役割を整理してみようと思います。
もし誤ってる箇所ありましたらご指摘いただけると有り難いです。
## 前提
Web APIは基本的にあるリソースに対して、何かしらの処理をする為に呼び出すものの認識です。
この「何かしらの操作」というのは、よくCRUD操作と言われる、

- CREATE
- READ
- UPDATE
- DELETE

に概ね分類されます。これらの操作が、HTTPのリクエストメソッドに上手いこと対応しており、
リクエストメソッドによって、リソースにどういった操作を行うか決定できるというわけですね。
（[MDNのサイト](https://developer.mozilla.org/ja/docs/Web/HTTP/Methods/PATCH)には、HTTPとCRUDを混同すべきじゃないとありましたが、説明の便宜上）

例えば、リソースとしてユーザ情報があったとして、これを`/users`というパスで表すとすると、

- GET /users/1：ID=1のユーザ情報を取得
- POST /users：新しいユーザを作成（作成するユーザ情報はパスではなくリクエストボディに含める）

のように、リクエストメソッドによって`/users`に対する操作を切り替えられるといった感じですね。

そして、各リクエストメソッドの役割について、私は現状以下の認識でいます。

## GET
指定したリソースを取得する。CRUDのうちの、READに相当。
例えばID=1のユーザを取得する場合は、
```
GET /users/1
```
のように指定。

## POST
指定したリソースを作成。CRUDのうちの、CREATEに相当。
作成するリソース名（IDなど）は、サーバ側で採番。

例えば、`taro`というユーザを追加する場合は、
```
POST /users

リクエストボディ
{
  name: 'taro',
  age: 18
}
```
のように指定。

## PUT
指定したリソースを置き換える。CRUDのうちの、CREATE/UPDATEに相当。
POSTと違って冪等（※）。（POSTは上述の通り、サーバ側でリソース名を採番する認識なので、冪等ではないという認識）

※ここは詳しい方に教えていただきたい箇所です。
PUTの説明として、「リソースが存在しない場合は新規作成、存在する場合は更新」というのもよく見かけますが、
個人的にリソース作成用にPOSTがある以上、PUTは冪等性を保ったほうが使い勝手が良い気がしているので、
新規作成はPOSTに一任させて、PUTは更新だけやるべき、という考えなんですがどうなんだろう。

例えば、ID=1のユーザ情報を置き換える場合は、
```
PUT /users/1

リクエストボディ
{
  name: 'taro',
  age: 24
}
```
リソースを新規作成したのか更新したのかについては、レスポンスコードを使い分けることで判別可能。
例. 200(OK) or 201(Created) or 204(No Content) or 404(Not Found)
ただし上述したように、個人的に新規作成はPUTで行わない認識。

## PATCH
指定したリソースの一部を置き換える。（あるいは情報を付け加える）
CRUDのうちの、UPDATEに相当。

例えば、ID=1のユーザの年齢のみ置き換える場合は、
```
PATCH /users/1

リクエストボディ
[
  {
    op: "replace",
    age: 32
  }
]
```

## DELETE
指定したリソースの削除。CRUDのうちの、DELETEに相当。

例えば、ID=1のユーザを削除するには、
```
DELETE /users/1
```

## まとめ
各HTTPリクエストメソッドの役割について、自分の現状の認識を上に整理してみました。
いざ整理してみると、当たり前ですがそれぞれ役割が違いますね。

ただその上で、結局のところはAPIの実装次第でどうとでも動きを変えれてしまうので、
私の今のプロジェクトでは上手く使い分けれてないということなんでしょうね。

実際の業務できっかり使い分けて実装されてるプロジェクトがどれくらいあるのか気になりました。

また冒頭でも記載しましたが、上記はあくまで今の私の認識ですので、
もし誤ってる箇所ありましたらご指摘いただけると有り難いです。

## 参照
[HTTP リクエストメソッド](https://developer.mozilla.org/ja/docs/Web/HTTP/Methods)
[HTTP レスポンスステータスコード](https://developer.mozilla.org/ja/docs/Web/HTTP/Status)
[REST API Tutorial](https://restfulapi.net/http-methods/)
[PATCH](https://developer.mozilla.org/ja/docs/Web/HTTP/Methods/PATCH)